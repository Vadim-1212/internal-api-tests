# Автотесты API сервиса аутентификации

Автоматизированные тесты для Spring Boot приложения с одним POST-эндпоинтом `/endpoint` (LOGIN/ACTION/LOGOUT).

## Стек технологий

- **Java 17**, **Maven**
- **JUnit 5** — тестовый фреймворк
- **WireMock 3** — мокирование внешнего сервиса
- **REST Assured** — HTTP-клиент для тестов
- **Allure** — отчётность (Epic/Feature/Story/Step)

## Структура проекта

```
├── app/                                    # Тестируемое приложение (jar)
├── pom.xml                                 # Maven зависимости
└── src/test/java/ru/testassignment/
    ├── config/TestConfig.java              # Конфигурация: порты, ключи, таймауты
    ├── helper/TokenGenerator.java          # Генератор токенов (валидных и невалидных)
    ├── base/
    │   ├── AppManager.java                 # Запуск/остановка тестируемого приложения
    │   └── BaseTest.java                   # Базовый класс: WireMock + lifecycle
    ├── client/EndpointClient.java          # REST Assured обёртка для HTTP-вызовов
    ├── steps/ApiSteps.java                 # @Step-методы для Allure-отчёта
    └── tests/
        ├── LoginTest.java                  # Аутентификация (6 тестов)
        ├── ActionTest.java                 # Выполнение действия (6 тестов)
        ├── LogoutTest.java                 # Завершение сессии (3 теста)
        ├── SessionFlowTest.java            # E2E цепочки (3 теста)
        ├── ValidationTest.java             # Валидация входных данных (12 тестов)
        └── WireMockVerificationTest.java   # Проверка обращений к моку (4 теста)
```

## Требования

- **Java 17+** (для запуска приложения и тестов)
- **Maven 3.8+**

## Запуск тестов

```bash
mvn clean test
```

## Allure-отчёт

```bash
# Сгенерировать и открыть отчёт в браузере
mvn allure:serve

# Или сгенерировать в target/site/allure-maven-plugin/
mvn allure:report
```

## Что тестируется (34 теста)

| Группа | Тестов | Что проверяем |
|--------|--------|---------------|
| LOGIN | 6 | Успешный вход, ошибки внешнего сервиса (400/403/500), дублирующийся токен, две сессии |
| ACTION | 6 | Успех после LOGIN, без LOGIN, после LOGOUT, ошибки мока, множественные действия |
| LOGOUT | 3 | Успешный выход, без LOGIN, повторный выход |
| E2E сценарии | 3 | Полный цикл, повторная сессия, независимость сессий |
| Валидация | 12 | API-ключ (отсутствие/невалидный), токен (короткий/длинный/lowercase/спецсимволы/пустой/не-HEX), action (пустой/невалидный/lowercase), пустой запрос |
| WireMock | 4 | Корректность запросов к /auth и /doAction, отсутствие запросов при LOGOUT, формат передачи токена |

## Принципы

- **Изоляция**: каждый тест — уникальный токен, WireMock стабы сбрасываются между тестами
- **Читаемость**: Allure-шаги на русском языке, понятные нетехническому человеку
- **AAA**: Arrange → Act → Assert в каждом тесте
